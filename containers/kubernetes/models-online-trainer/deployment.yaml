apiVersion: apps/v1
kind: Deployment
metadata:
    name: models-online-trainer
    namespace: nrocinu
spec:
    replicas: 1
    selector:
        matchLabels:
            app: models-online-trainer
    template:
        metadata:
            labels:
                app: models-online-trainer
        spec:
            containers:
                - name: models-online-trainer
                  image: registry.optirec.ml/models-online-trainer:latest
                  imagePullPolicy: Always
                  env:
                      - name: SERVICE
                        value: 'online_trainer'
                      - name: MODELS_PATH
                        value: '/opt/models'
                      - name: DATA_PATH
                        value: '/opt/data'
                      - name: DB_HOST
                        value: 'postgres'
                      - name: REDIS_PUBSUB_HOST
                        value: 'redis-pubsub'
                      - name: RABBITMQ_HOST
                        value: 'rabbitmq'
                  envFrom:
                    - configMapRef:
                        name: generic
                    - secretRef:
                        name: rabbitmq-secret
                  volumeMounts:
                      - name: models-storage
                        mountPath: /opt/models
                      - name: data-storage
                        mountPath: /opt/data
            volumes:
                - name: models-storage
                  hostPath:
                    path: /opt/nrocinu/models
                - name: data-storage
                  hostPath:
                    path: /opt/nrocinu/data
